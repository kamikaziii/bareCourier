# Code Review Template

> Use this template to plan multi-agent reviews without hitting context limits.

## Pre-Review Checklist

```bash
# 1. Count files to determine review strategy
find src -name "*.ts" -o -name "*.svelte" | wc -l

# 2. Identify hot directories
find src -type f \( -name "*.ts" -o -name "*.svelte" \) | cut -d'/' -f1-3 | sort | uniq -c | sort -rn | head -20
```

| File Count | Strategy |
|------------|----------|
| <50 files | Single-pass parallel, 2-3 agents |
| 50-200 files | Two-phase (discovery + focused) |
| 200+ files | Hierarchical multi-pass |

## Review Scope Definition

### Step 1: Define Boundaries

```markdown
## Files IN Scope
- src/routes/courier/** (courier features)
- src/lib/services/** (business logic)
- src/hooks.server.ts (auth)

## Files OUT of Scope
- src/lib/components/ui/** (shadcn-svelte, third-party)
- node_modules/**
- static/**
```

### Step 2: Assign Agents to Chunks

```markdown
## Agent Assignments

### Agent 1: Security
Files: src/hooks.server.ts, src/routes/**/+layout.server.ts
Focus: Auth bypass, session handling, input validation
Max turns: 5

### Agent 2: Performance
Files: src/routes/**/+page.server.ts
Focus: N+1 queries, missing indexes, inefficient patterns
Max turns: 5

### Agent 3: Patterns
Files: src/routes/**/*.svelte, src/lib/components/*.svelte
Focus: Svelte 5 compliance, code duplication, naming
Max turns: 5
```

## Agent Prompt Template

```markdown
## Task: [REVIEW_TYPE] Review - [SCOPE]

### Scope
Only analyze these files:
- [file1.ts]
- [file2.ts]
- [pattern/**/*.ts]

### Focus Areas
1. [Specific concern 1]
2. [Specific concern 2]

### Output Format
Return a JSON summary:
{
  "files_analyzed": number,
  "critical": [{ "file": "path", "line": N, "issue": "description" }],
  "warnings": [{ "file": "path", "line": N, "issue": "description" }],
  "summary": "One paragraph overall assessment"
}

### Constraints
- Do NOT read files outside scope
- Stop at 10 issues maximum
- Prioritize critical over comprehensive
```

## Parallel Execution Pattern

```javascript
// Launch scoped agents in parallel
Task(security-sentinel, scope: "auth-files-only")
Task(performance-oracle, scope: "server-files-only")
Task(pattern-recognition, scope: "svelte-components-only")

// Wait for all, then synthesize
Task(synthesizer): "Read all agent outputs, produce prioritized list"
```

## Context Budget Guidelines

| Context Usage | Action |
|---------------|--------|
| 0-40% | Normal operation |
| 40-60% | Consider narrowing scope |
| 60-80% | Use /compact, reduce agent count |
| 80%+ | Stop, checkpoint, start fresh session |

## Output Persistence

Agents should write findings to disk, not context:

```
docs/review-findings/
├── security-findings.md
├── performance-findings.md
├── patterns-findings.md
└── SUMMARY.md  # Generated by synthesizer
```

## Quick Start Commands

```bash
# Small review (< 50 files, single domain)
claude "Review src/routes/courier/** for security issues. Focus on auth and input validation. Max 5 files deep."

# Medium review (50-200 files)
claude "/workflows:review --scope=courier --phases=discovery,analysis"

# Large review (200+ files)
claude "/workflows:review --scope=full --strategy=hierarchical --max-agents=3"
```

## Post-Review Checklist

- [ ] All agents completed without context exhaustion
- [ ] Findings written to docs/review-findings/
- [ ] Critical issues have file:line references
- [ ] Summary synthesizes across all agents
- [ ] Action items created in todos/ directory

---

*Template version: 1.0*
*Based on: bareCourier review learnings 2026-01-26*
